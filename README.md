<div align="center">
  <img height="120x" src="https://uploads-ssl.webflow.com/611580035ad59b20437eb024/616f97a42f5637c4517d0193_Logo%20(1)%20(1).png" />

  <h1 style="margin-top:20px;">Keeper Bots for Drift Protocol v2</h1>

  <p>
    <a href="https://docs.drift.trade/tutorial-keeper-bots"><img alt="Docs" src="https://img.shields.io/badge/docs-tutorials-blueviolet" /></a>
    <a href="https://discord.com/channels/849494028176588802/878700556904980500"><img alt="Discord Chat" src="https://img.shields.io/discord/889577356681945098?color=blueviolet" /></a>
    <a href="https://opensource.org/licenses/Apache-2.0"><img alt="License" src="https://img.shields.io/github/license/project-serum/anchor?color=blueviolet" /></a>
  </p>
</div>

# Setting up
## Setup Environment
```shell
cp .env.example .env
```

Update values in `.env` accordingly

`KEEPER_PRIVATE_KEY`: can be a number array (as in example), or a path to a `keypair.json` as generated by `solana-keygen`. The address of this key requires SOL since it will be the signing authority of all transactions sent by this bot.

## Initialize User

A `ClearingHouseUser` must be created before interacting with the `ClearingHouse` program.

```shell
yarn run dev --init-user
```

## Depositing Collateral

Some bots (i.e. trading, liquidator and JIT makers) require collateral in order to keep positions open, a helper function is included to help with depositing collateral.
A user must be initialized first before collateral may be deposited.

```shell
# deposit 10,000 USDC
yarn run dev --force-deposit 10000
```

# Run Bots

By default, some [Prometheus](https://prometheus.io/) metrics are exposed on `localhost:9464/metrics`.

## Run Filler Bot
```shell
yarn
yarn run dev:filler
```

## Run Trigger Bot
```shell
yarn
yarn run dev:filler
```

## Run JIT Maker Bot

âš  requires collateral

```shell
yarn
yarn run dev:jitmaker
```

# Running with Docker Compose 

There is a docker-compose file for running all the keeper bot variants along with monitoring functionality.
To do this you first need to follow the above steps - Setup Environment, Initialize User and Depositing Collateral

To use this first build the docker image:

`docker build . -t drift/keeper:latest`

Then run:

`docker-compose up -d`

You can view the metrics bots metrics in Grafana at `localhost:3000`
The user name is drift, password is drift

There are pre-configured dashboards for each of the bot types along with several dashboards for monitoring the host machine resources and container resource use.

## Status

The Dashboards need to refined to show what is relevant for each bot as there are many metrics exported by the bots that are not currently displayed
A centralized logging solution would be very useful to add